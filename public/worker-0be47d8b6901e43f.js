(()=>{"use strict";self.addEventListener("push",t=>{if(!t.data)return void console.log("[SW] Push received but no data");try{let i=t.data.json(),e={body:i.body||"Расписание было обновлено",icon:i.icon||"/favicon.png",badge:i.badge||"/favicon.png",tag:i.tag||"schedule-update",data:i.data||{},requireInteraction:!1};t.waitUntil(self.registration.showNotification(i.title||"Расписание РГСУ",e))}catch(t){console.error("[SW] Error processing push:",t)}}),self.addEventListener("notificationclick",t=>{if(t.notification.close(),"dismiss"===t.action)return;let i=t.notification.data?.url||"/";t.waitUntil(self.clients.matchAll({type:"window",includeUncontrolled:!0}).then(e=>{for(let i of e)if(i.url.includes(self.location.origin)&&"focus"in i){i.focus(),i.postMessage({type:"SCHEDULE_UPDATE",data:t.notification.data});return}if(self.clients.openWindow)return self.clients.openWindow(i)}))}),self.addEventListener("notificationclose",t=>{console.log("[SW] Notification closed:",t.notification.tag)})})();